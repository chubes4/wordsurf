(()=>{"use strict";var e={20:(e,t,s)=>{var n=s(609),r=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,s){var n,l={},c=null,u=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!i.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===l[n]&&(l[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:u,props:l,_owner:a.current}}},609:e=>{e.exports=window.React},848:(e,t,s)=>{e.exports=s(20)}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};s.r(n),s.d(n,{closeModal:()=>U,disableComplementaryArea:()=>O,enableComplementaryArea:()=>k,openModal:()=>j,pinItem:()=>I,setDefaultComplementaryArea:()=>T,setFeatureDefaults:()=>L,setFeatureValue:()=>D,toggleFeature:()=>x,unpinItem:()=>N});var r={};s.r(r),s.d(r,{getActiveComplementaryArea:()=>F,isComplementaryAreaLoading:()=>$,isFeatureActive:()=>H,isItemPinned:()=>V,isModalActive:()=>z});var o=s(609),a=s.n(o);const i=window.wp.plugins,l=window.wp.editor,c=window.wp.i18n,u=window.wp.element,d=window.wp.data;function p(e){if(!e.role)throw new Error("Message must have a role property");if(!["user","assistant","tool","system"].includes(e.role))throw new Error(`Invalid role: ${e.role}`);return e}function m(e){return e.map(p)}function g(e){return{role:"user",content:e}}class f{constructor(){this.pendingToolResults=new Map}createToolCall(e,t,s){return function(e,t,s){return{role:"assistant",content:null,tool_calls:[{id:e,type:"function",function:{name:t,arguments:s}}]}}(e,t,s)}createToolResult(e,t){return function(e,t){return{role:"tool",tool_call_id:e,content:JSON.stringify(t)}}(e,t)}createToolCallAndResult(e,t,s,n){return[this.createToolCall(e,t,s),this.createToolResult(e,n)]}trackPendingResult(e,t,s,n){return this.pendingToolResults.set(e,{name:t,arguments:s,result:n}),this}getPendingResultMessages(){const e=[];return this.pendingToolResults.forEach((t,s)=>{const[n,r]=this.createToolCallAndResult(s,t.name,t.arguments,t.result);e.push(n,r)}),e}clearPendingResults(){return this.pendingToolResults.clear(),this}hasPendingResults(){return this.pendingToolResults.size>0}getPendingResultCount(){return this.pendingToolResults.size}createUserDecisionMessage(e,t){const s="accepted"===e?"accepted":"rejected",n=t.tool_type||"tool";let r=`User ${s} the ${n} suggestion.`;return"accepted"===e&&(r+=this.getAcceptanceDetails(n,t)),g(r)}getAcceptanceDetails(e,t){switch(e){case"edit_post":return` The text "${t.search_pattern}" was changed to "${t.replacement_text}" in the post.`;case"insert_content":return" New content was added to the post.";case"write_to_post":return" The post content was completely replaced.";default:return""}}debug(){console.log("ToolHistory Debug:",{pendingToolResults:this.pendingToolResults.size,pendingTools:Array.from(this.pendingToolResults.keys())})}}class h{constructor(e=[]){this.messages=this.validateInitialMessages(e),this.toolHistory=new f}validateInitialMessages(e){return m(e)}getMessages(){return[...this.messages]}getOpenAIMessages(){return m(this.messages.filter(e=>"user"!==e.role||!e.content||!e.content.startsWith("User accepted the")&&!e.content.startsWith("User rejected the")).map(e=>{const{isStreaming:t,...s}=e;return s}))}getUIMessages(){return function(e){const t=[];for(let s=0;s<e.length;s++){const n=e[s];if("user"===n.role||"assistant"===n.role&&n.content)t.push({author:"user"===n.role?"user":"agent",content:n.content,type:"text",isStreaming:n.isStreaming||!1});else if("assistant"===n.role&&n.tool_calls){const r=n.tool_calls[0],o=e[s+1];let a=null;if(o&&"tool"===o.role&&o.tool_call_id===r.id){try{a=JSON.parse(o.content)}catch(e){console.error("Failed to parse tool result content:",o.content)}s++}t.push({author:"agent",type:"tool",tool_name:r.function.name,tool_args:r.function.arguments,result:a,id:r.id})}}return t}(this.messages)}addUserMessage(e){return this.messages.push(g(e)),this}addOrUpdateAssistantMessage(e){const t=this.getLastMessage();return t&&"assistant"===t.role&&t.isStreaming?t.content+=e:this.messages.push({role:"assistant",content:e,isStreaming:!0}),this}finalizeLastMessage(){const e=this.getLastMessage();return e&&e.isStreaming&&(e.isStreaming=!1),this}addAssistantMessage(e){return this.messages.push(function(e){return{role:"assistant",content:e}}(e)),this}addToolCall(e,t,s){const n=this.toolHistory.createToolCall(e,t,s);return this.messages.push(n),this}addToolResult(e,t){const s=this.toolHistory.createToolResult(e,t);return this.messages.push(s),this}addToolCallAndResult(e,t,s,n){const[r,o]=this.toolHistory.createToolCallAndResult(e,t,s,n);return this.messages.push(r,o),this}trackPendingToolResult(e,t,s,n){return this.toolHistory.trackPendingResult(e,t,s,n),this}flushPendingToolResults(){const e=this.toolHistory.getPendingResultMessages();return this.messages.push(...e),this.toolHistory.clearPendingResults(),this}addUserDecision(e,t){const s=this.toolHistory.createUserDecisionMessage(e,t);return this.messages.push(s),this}clear(){return this.messages=[],this.toolHistory.clearPendingResults(),this}getLastMessage(){return this.messages[this.messages.length-1]||null}getMessageCount(){return this.messages.length}setMessages(e){return this.messages=m(e),this}debug(){console.log("ChatHistory Debug:",{messageCount:this.messages.length,messages:this.messages}),this.toolHistory.debug()}}const v=window.wp.blocks;function y(e){var t,s,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(s=y(e[t]))&&(n&&(n+=" "),n+=s)}else for(s in e)e[s]&&(n&&(n+=" "),n+=s);return n}const w=function(){for(var e,t,s=0,n="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=y(e))&&(n&&(n+=" "),n+=t);return n},E=window.wp.components;var C=s(848);function _({scope:e,...t}){return(0,C.jsx)(E.Fill,{name:`PinnedItems/${e}`,...t})}_.Slot=function({scope:e,className:t,...s}){return(0,C.jsx)(E.Slot,{name:`PinnedItems/${e}`,...s,children:e=>e?.length>0&&(0,C.jsx)("div",{className:w(t,"interface-pinned-items"),children:e})})};const b=_,S=window.wp.deprecated;var A=s.n(S);const P=window.wp.preferences;function M(e){return["core/edit-post","core/edit-site"].includes(e)?(A()(`${e} interface scope`,{alternative:"core interface scope",hint:"core/edit-post and core/edit-site are merging.",version:"6.6"}),"core"):e}function R(e,t){return"core"===e&&"edit-site/template"===t?(A()("edit-site/template sidebar",{alternative:"edit-post/document",version:"6.6"}),"edit-post/document"):"core"===e&&"edit-site/block-inspector"===t?(A()("edit-site/block-inspector sidebar",{alternative:"edit-post/block",version:"6.6"}),"edit-post/block"):t}const T=(e,t)=>({type:"SET_DEFAULT_COMPLEMENTARY_AREA",scope:e=M(e),area:t=R(e,t)}),k=(e,t)=>({registry:s,dispatch:n})=>{t&&(e=M(e),t=R(e,t),s.select(P.store).get(e,"isComplementaryAreaVisible")||s.dispatch(P.store).set(e,"isComplementaryAreaVisible",!0),n({type:"ENABLE_COMPLEMENTARY_AREA",scope:e,area:t}))},O=e=>({registry:t})=>{e=M(e),t.select(P.store).get(e,"isComplementaryAreaVisible")&&t.dispatch(P.store).set(e,"isComplementaryAreaVisible",!1)},I=(e,t)=>({registry:s})=>{if(!t)return;e=M(e),t=R(e,t);const n=s.select(P.store).get(e,"pinnedItems");!0!==n?.[t]&&s.dispatch(P.store).set(e,"pinnedItems",{...n,[t]:!0})},N=(e,t)=>({registry:s})=>{if(!t)return;e=M(e),t=R(e,t);const n=s.select(P.store).get(e,"pinnedItems");s.dispatch(P.store).set(e,"pinnedItems",{...n,[t]:!1})};function x(e,t){return function({registry:s}){A()("dispatch( 'core/interface' ).toggleFeature",{since:"6.0",alternative:"dispatch( 'core/preferences' ).toggle"}),s.dispatch(P.store).toggle(e,t)}}function D(e,t,s){return function({registry:n}){A()("dispatch( 'core/interface' ).setFeatureValue",{since:"6.0",alternative:"dispatch( 'core/preferences' ).set"}),n.dispatch(P.store).set(e,t,!!s)}}function L(e,t){return function({registry:s}){A()("dispatch( 'core/interface' ).setFeatureDefaults",{since:"6.0",alternative:"dispatch( 'core/preferences' ).setDefaults"}),s.dispatch(P.store).setDefaults(e,t)}}function j(e){return{type:"OPEN_MODAL",name:e}}function U(){return{type:"CLOSE_MODAL"}}const F=(0,d.createRegistrySelector)(e=>(t,s)=>{s=M(s);const n=e(P.store).get(s,"isComplementaryAreaVisible");if(void 0!==n)return!1===n?null:t?.complementaryAreas?.[s]}),$=(0,d.createRegistrySelector)(e=>(t,s)=>{s=M(s);const n=e(P.store).get(s,"isComplementaryAreaVisible"),r=t?.complementaryAreas?.[s];return n&&void 0===r}),V=(0,d.createRegistrySelector)(e=>(t,s,n)=>{var r;n=R(s=M(s),n);const o=e(P.store).get(s,"pinnedItems");return null===(r=o?.[n])||void 0===r||r}),H=(0,d.createRegistrySelector)(e=>(t,s,n)=>(A()("select( 'core/interface' ).isFeatureActive( scope, featureName )",{since:"6.0",alternative:"select( 'core/preferences' ).get( scope, featureName )"}),!!e(P.store).get(s,n)));function z(e,t){return e.activeModal===t}const W=(0,d.combineReducers)({complementaryAreas:function(e={},t){switch(t.type){case"SET_DEFAULT_COMPLEMENTARY_AREA":{const{scope:s,area:n}=t;return e[s]?e:{...e,[s]:n}}case"ENABLE_COMPLEMENTARY_AREA":{const{scope:s,area:n}=t;return{...e,[s]:n}}}return e},activeModal:function(e=null,t){switch(t.type){case"OPEN_MODAL":return t.name;case"CLOSE_MODAL":return null}return e}}),B=(0,d.createReduxStore)("core/interface",{reducer:W,actions:n,selectors:r});(0,d.register)(B);class J{diff(e,t,s={}){let n;"function"==typeof s?(n=s,s={}):"callback"in s&&(n=s.callback);const r=this.castInput(e,s),o=this.castInput(t,s),a=this.removeEmpty(this.tokenize(r,s)),i=this.removeEmpty(this.tokenize(o,s));return this.diffWithOptionsObj(a,i,s,n)}diffWithOptionsObj(e,t,s,n){var r;const o=e=>(e=this.postProcess(e,s),n?void setTimeout(function(){n(e)},0):e),a=t.length,i=e.length;let l=1,c=a+i;null!=s.maxEditLength&&(c=Math.min(c,s.maxEditLength));const u=null!==(r=s.timeout)&&void 0!==r?r:1/0,d=Date.now()+u,p=[{oldPos:-1,lastComponent:void 0}];let m=this.extractCommon(p[0],t,e,0,s);if(p[0].oldPos+1>=i&&m+1>=a)return o(this.buildValues(p[0].lastComponent,t,e));let g=-1/0,f=1/0;const h=()=>{for(let n=Math.max(g,-l);n<=Math.min(f,l);n+=2){let r;const l=p[n-1],c=p[n+1];l&&(p[n-1]=void 0);let u=!1;if(c){const e=c.oldPos-n;u=c&&0<=e&&e<a}const d=l&&l.oldPos+1<i;if(u||d){if(r=!d||u&&l.oldPos<c.oldPos?this.addToPath(c,!0,!1,0,s):this.addToPath(l,!1,!0,1,s),m=this.extractCommon(r,t,e,n,s),r.oldPos+1>=i&&m+1>=a)return o(this.buildValues(r.lastComponent,t,e))||!0;p[n]=r,r.oldPos+1>=i&&(f=Math.min(f,n-1)),m+1>=a&&(g=Math.max(g,n+1))}else p[n]=void 0}l++};if(n)!function e(){setTimeout(function(){if(l>c||Date.now()>d)return n(void 0);h()||e()},0)}();else for(;l<=c&&Date.now()<=d;){const e=h();if(e)return e}}addToPath(e,t,s,n,r){const o=e.lastComponent;return o&&!r.oneChangePerToken&&o.added===t&&o.removed===s?{oldPos:e.oldPos+n,lastComponent:{count:o.count+1,added:t,removed:s,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:s,previousComponent:o}}}extractCommon(e,t,s,n,r){const o=t.length,a=s.length;let i=e.oldPos,l=i-n,c=0;for(;l+1<o&&i+1<a&&this.equals(s[i+1],t[l+1],r);)l++,i++,c++,r.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return c&&!r.oneChangePerToken&&(e.lastComponent={count:c,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=i,l}equals(e,t,s){return s.comparator?s.comparator(e,t):e===t||!!s.ignoreCase&&e.toLowerCase()===t.toLowerCase()}removeEmpty(e){const t=[];for(let s=0;s<e.length;s++)e[s]&&t.push(e[s]);return t}castInput(e,t){return e}tokenize(e,t){return Array.from(e)}join(e){return e.join("")}postProcess(e,t){return e}get useLongestToken(){return!1}buildValues(e,t,s){const n=[];let r;for(;e;)n.push(e),r=e.previousComponent,delete e.previousComponent,e=r;n.reverse();const o=n.length;let a=0,i=0,l=0;for(;a<o;a++){const e=n[a];if(e.removed)e.value=this.join(s.slice(l,l+e.count)),l+=e.count;else{if(!e.added&&this.useLongestToken){let n=t.slice(i,i+e.count);n=n.map(function(e,t){const n=s[l+t];return n.length>e.length?n:e}),e.value=this.join(n)}else e.value=this.join(t.slice(i,i+e.count));i+=e.count,e.added||(l+=e.count)}}return n}}const Y=new class extends J{},q=({diffContext:e,onAccept:t,onReject:s})=>{const{diffs:n}=e,[r,a]=(0,o.useState)(null),[i,l]=(0,o.useState)(!1),{blocks:c}=(0,d.useSelect)(e=>({blocks:e("core/block-editor").getBlocks()})),{lockPostSaving:u,unlockPostSaving:p}=(0,d.useDispatch)("core/editor"),{replaceBlocks:m}=(0,d.useDispatch)("core/block-editor");return(0,o.useEffect)(()=>{if(n.length>0&&!i){const s=n[0],{original_content:r,new_content:o}=s;a(c),u("wordsurf-diff-preview"),l(!0);const i=(e=r,t=o,Y.diff(e,t,undefined)).map(e=>{const t=e.added?"ins":e.removed?"del":"span";return`<${t} class="${e.added?"wordsurf-diff-ins":e.removed?"wordsurf-diff-del":""}">${e.value}</${t}>`}).join(""),d=(0,v.createBlock)("core/html",{content:i});m(c.map(e=>e.clientId),d)}var e,t},[n,i,c,u,m]),(0,o.createElement)(E.Fill,{name:"PluginHeader"},i&&(0,o.createElement)(b,null,(0,o.createElement)("div",{style:{display:"flex",gap:"8px",alignItems:"center",color:"#1e1e1e",backgroundColor:"#fff",padding:"4px 8px",borderRadius:"4px",border:"1px solid #ddd"}},(0,o.createElement)("strong",null,"Wordsurf Change Preview:"),(0,o.createElement)(E.Button,{isPrimary:!0,onClick:()=>{const e=n[0],s=(0,v.parse)(e.new_content);m(c.map(e=>e.clientId),s),p("wordsurf-diff-preview"),a(null),l(!1),t(e)}},"Accept Changes"),(0,o.createElement)(E.Button,{isSecondary:!0,onClick:()=>{const e=n[0];m(c.map(e=>e.clientId),r),p("wordsurf-diff-preview"),a(null),l(!1),s(e)}},"Reject"))))},K=({name:e,args:t,result:s,status:n})=>{let r=t;if("string"==typeof t)try{r=JSON.parse(t)}catch(e){}return(0,o.createElement)("div",{className:"tool-call"},(0,o.createElement)("div",{className:"tool-header"},"in_progress"===n?(0,o.createElement)("div",{className:"spinner"}):!0===s?.success?(0,o.createElement)("div",{className:"icon"},"✅"):!1===s?.success?(0,o.createElement)("div",{className:"icon"},"❌"):(0,o.createElement)("div",{className:"icon"},"⚙️"),(0,o.createElement)("span",{className:"tool-name"},e)))},G=({message:e})=>"tool"===e.type?(0,o.createElement)("div",{className:`chat-message ${e.author}`},(0,o.createElement)(K,{name:e.tool_name,args:e.tool_args,result:e.result,status:e.result?"completed":"in_progress"})):(0,o.createElement)("div",{className:`chat-message ${e.author}`},(0,o.createElement)("div",{className:"chat-bubble"},e.content,e.isStreaming&&(0,o.createElement)("span",{className:"typing-indicator"},(0,o.createElement)("span",null),(0,o.createElement)("span",null),(0,o.createElement)("span",null)))),Q=({value:e,onChange:t,onSend:s,disabled:n=!1,placeholder:r="Ask me to edit, write, or brainstorm..."})=>(0,o.createElement)("div",{className:"wordsurf-input-area"},(0,o.createElement)("textarea",{value:e,onChange:t,placeholder:r,disabled:n,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s())}}),(0,o.createElement)("button",{onClick:s,disabled:n||!e.trim()},"Send")),X=({messages:e,isWaiting:t,inputValue:s,onInputChange:n,onSend:r,isStreaming:i})=>{const l=a().useRef(null);return a().useEffect(()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},[e]),(0,o.createElement)("div",{className:"wordsurf-sidebar-content"},(0,o.createElement)("div",{className:"wordsurf-chat-window",ref:l},e.map((e,t)=>(0,o.createElement)(G,{key:t,message:e})),t&&(0,o.createElement)("div",{className:"chat-message agent"},(0,o.createElement)("div",{className:"chat-bubble"},"Thinking...",(0,o.createElement)("span",{className:"typing-indicator"},(0,o.createElement)("span",null),(0,o.createElement)("span",null),(0,o.createElement)("span",null))))),(0,o.createElement)(Q,{value:s,onChange:n,onSend:r,disabled:i}))},Z="wordsurf",ee=(0,c.__)("Wordsurf","wordsurf"),te=()=>(0,o.createElement)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.createElement)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8 8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z",fill:"currentColor"}),(0,o.createElement)("path",{d:"M12 12m-6 0a6 6 0 1 0 12 0a6 6 0 1 0 -12 0",fill:"currentColor",fillOpacity:"0.3"}));wp.plugins.getPlugin(Z)||(0,i.registerPlugin)(Z,{render:()=>{const[e,t]=(0,u.useState)({originalContent:"",diffs:[]}),s=(0,u.useRef)(new h([])),n=(0,d.useSelect)(e=>{const{getCurrentPostId:t,getEditedPostAttribute:s}=e("core/editor");return{postId:t(),title:s("title"),content:s("content"),status:s("status"),type:s("type")}}),r=(0,u.useCallback)(e=>{t(t=>({...t,diffs:[...t.diffs,e]}))},[]),a=(({postId:e,onDiffReceived:t,onUserDecision:s,chatHistory:n})=>{const[r,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)(!1),[c,u]=(0,o.useState)(""),[d,p]=(0,o.useState)(n.current.getUIMessages()),m=(0,o.useRef)(""),g=(0,o.useRef)(null),f=(0,o.useCallback)(()=>{p([...n.current.getUIMessages()])},[n]),h=(0,o.useCallback)(()=>{m.current.length>0&&(n.current.addOrUpdateAssistantMessage(m.current),m.current="",f()),g.current=null},[n,f]);(0,o.useEffect)(()=>()=>{g.current&&cancelAnimationFrame(g.current)},[]);const v=(0,o.useCallback)((e,t)=>{n.current.addUserDecision(e,t),f()},[n,f]),y=(0,o.useCallback)(async()=>{const t=c.trim();t&&!r&&(n.current.addUserMessage(t),f(),u(""),a(!0),l(!0),function(e,t,s,n,r){const o=new URLSearchParams({action:"wordsurf_stream_chat",messages:JSON.stringify(e),post_id:t,context_window:JSON.stringify({}),nonce:window.wordsurfData?.nonce||""}),a=new EventSource(`${window.wordsurfData.ajax_url}?${o.toString()}`);a.addEventListener("response.output_text.delta",e=>{try{const t=JSON.parse(e.data);t.delta&&s({type:"text",data:{content:t.delta}})}catch(t){console.error("Failed to parse text delta:",e.data,t)}}),a.addEventListener("response.output_item.added",e=>{try{const t=JSON.parse(e.data);t.item&&"function_call"===t.item.type&&s({type:"tool_start",data:t.item})}catch(t){console.error("Failed to parse tool start:",e.data,t)}}),a.addEventListener("response.completed",e=>{console.log("StreamApi: Stream completed by API."),a.close(),n&&n()}),a.addEventListener("error",e=>{console.error("EventSource error:",e),a.readyState===EventSource.CLOSED?n&&n():r&&r(),a.close()})}(n.current.getOpenAIMessages(),e,e=>{if(l(!1),e.type&&e.data)if("tool_start"===e.type){h();const{name:t,call_id:s,arguments:r}=e.data;n.current.addToolCall(s,t,r),f()}else"text"===e.type&&null!=e.data.content&&(m.current+=e.data.content,g.current||(g.current=requestAnimationFrame(h)))},()=>{h(),n.current.finalizeLastMessage(),f(),a(!1),l(!1)},e=>{h(),n.current.addOrUpdateAssistantMessage("Sorry, there was an error."),n.current.finalizeLastMessage(),f(),a(!1),l(!1)}))},[e,n,c,r,t,f,h]);return{isStreaming:r,isWaiting:i,inputValue:c,setInputValue:u,uiMessages:d,handleSend:y,updateUIMessages:f,recordUserDecision:v}})({postId:n.postId,onDiffReceived:r,chatHistory:s}),i=(0,u.useCallback)(e=>{a.recordUserDecision("accepted",e),t(t=>({...t,diffs:t.diffs.filter(t=>t.tool_call_id!==e.tool_call_id)}))},[a]),c=(0,u.useCallback)(e=>{a.recordUserDecision("rejected",e),t(t=>({...t,diffs:t.diffs.filter(t=>t.tool_call_id!==e.tool_call_id)}))},[a]);return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(l.PluginSidebarMoreMenuItem,{target:Z},ee),(0,o.createElement)(l.PluginSidebar,{name:Z,title:ee,icon:(0,o.createElement)(te,null)},(0,o.createElement)(X,{messages:a.uiMessages,isWaiting:a.isWaiting,inputValue:a.inputValue,onInputChange:e=>a.setInputValue(e.target.value),onSend:()=>{t(e=>({...e,originalContent:n.content,diffs:[]})),a.handleSend()},isStreaming:a.isStreaming})),(0,o.createElement)(q,{diffContext:e,onAccept:i,onReject:c}))}})})();